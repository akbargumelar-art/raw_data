
# Deployment Guide for Ubuntu VPS (via GitHub)

Target: /var/www/raw
Domain: raw.abkciraya.cloud
Port: 6002
Database Host: agrabudi.com

## 1. Environment Setup

Access your VPS via SSH and install Node.js (if not installed):
```bash
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs git
sudo npm install -g pm2
```

## 2. Clone Project from GitHub

Navigate to the target directory and clone your repository:

```bash
sudo mkdir -p /var/www/raw
sudo chown -R $USER:$USER /var/www/raw
cd /var/www/raw

# Replace [YOUR_REPO_URL] with your actual GitHub repository URL
git clone [YOUR_REPO_URL] .
```

## 3. Install Dependencies & Build Frontend

```bash
# Install root dependencies (React, Vite, Express, etc)
npm install

# Build the React frontend for production
# This creates the 'dist' folder which the Node server serves
npm run build
```

## 4. Backend Configuration (.env)

Create a production `.env` file. This file should **NOT** be committed to GitHub for security.

```bash
nano .env
```

Paste the following configuration:
```env
# Database Credentials (Remote)
DB_HOST=agrabudi.com
DB_USER=akbar
DB_PASS=Ciraya@555
DB_PORT=52306
DB_NAME=akbar

# App Configuration
APP_PORT=6002
JWT_SECRET=rahasia_super_secure_ganti_ini_nanti
```
*Press Ctrl+X, then Y, then Enter to save.*

## 5. Initialize Database (First Time Only)

Run the server once to verify connection and create the initial Admin user.

```bash
node server/server.js
```
*Expected Output:*
> ðŸš€ Server running on http://localhost:6002
> âœ… Database connected successfully...
> âœ… System Initialized: Default admin user created...

*Press Ctrl+C to stop.*

## 6. Start Application with PM2

Use PM2 to keep the application running in the background.

```bash
# Start the server
pm2 start server/server.js --name "dataflow-pro"

# Save the process list so it restarts on reboot
pm2 save
pm2 startup
```

## 7. Nginx Reverse Proxy Setup

Configure Nginx to forward traffic from `raw.abkciraya.cloud` to port `6002`.

```bash
sudo nano /etc/nginx/sites-available/raw.abkciraya.cloud
```

Paste configuration:
```nginx
server {
    listen 80;
    server_name raw.abkciraya.cloud;

    location / {
        proxy_pass http://localhost:6002;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

Enable the site and restart Nginx:
```bash
sudo ln -s /etc/nginx/sites-available/raw.abkciraya.cloud /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

## 8. SSL Certificate (Certbot)

Secure your domain with HTTPS:

```bash
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d raw.abkciraya.cloud
```

---

### Update Procedure (Future Updates)

To update the app later:
```bash
cd /var/www/raw
git pull origin main
npm install
npm run build
pm2 restart dataflow-pro
```
